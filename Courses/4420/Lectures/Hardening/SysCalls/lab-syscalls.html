<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2019-11-01 Fri 07:59 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lab on Add/ Delete/ Freeze System Calls</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Prabhaker Mateti" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<style> P,li {text-align: justify} code {color: brown;} @media screen {BODY {margin: 10%} }</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="../"> UP </a>
 |
 <a accesskey="H" href="../../../Top/index.html"> HOME </a>
</div><div id="preamble" class="status">
<a href="../../"> ../../</a>
</div>
<div id="content">
<h1 class="title">Lab on Add/ Delete/ Freeze System Calls</h1>

<div id="outline-container-org39dd5ea" class="outline-2">
<h2 id="org39dd5ea"><span class="section-number-2">1</span> Background</h2>
<div class="outline-text-2" id="text-1">
<ol class="org-ol">
<li>Object: Learn to harden a kernel through Add/ Delete/ Freeze System
Calls.</li>

<li>This lab is coupled to to hardening the Linux kernel.
Learn the Linux kernel API usage.  Use a kernel in the 5.4.* (2019)
series.</li>

<li>Section 2 of Man Pages is about syscalls.  Study one or two
man pages, say, of <code>open</code>, and <code>close</code>.  You will be asked to
develop/ write man pages for the new syscalls following these.</li>

<li>Prerequisite Actions:
<a href="http://kernel.ubuntu.com/~kernel-ppa/mainline/daily/">http://kernel.ubuntu.com/~kernel-ppa/mainline/daily/</a> [Use the
latest date when amd64 build succeeded.] Download the (i)
<code>linux-image-*-generic*amd64.deb</code> and (ii)
<code>linux-modules-*-generic*amd64.deb</code> packages on to your own
machine, or use our VCSL (Virtual Cyber Security Lab) at WSU.  The
package (i) includes a Linux kernel (vmlinuz) + initial-ramdisk
(initrd) images, the package (ii) includes modules.</li>

<li>[WIP] Omit PLT and GOT.  Good to know these, but not necessary in
this Lab.</li>
</ol>
</div>
</div>


<div id="outline-container-org647a138" class="outline-2">
<h2 id="org647a138"><span class="section-number-2">2</span> Tasks</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org1a5f63a" class="outline-3">
<h3 id="org1a5f63a"><span class="section-number-3">2.1</span> Task: Become Familiar with System Call Internals [40 points]</h3>
<div class="outline-text-3" id="text-2-1">
<ol class="org-ol">
<li><code>dpkg -i --force-all linux-*.deb</code> installs the two packages
downloaded above.  It does not displace the existing kernels + initrd +
modules.  It does add a new entry in the Grub menu for the newly
added.</li>

<li>Report the addresses of sys-call-table, [TBD WIP PLT, and GOT]
before the install of the new kernel.  Include a description of how
you discovered these.</li>

<li>Reboot into the newly installed kernel.  Show the output of <code>uname
   -a</code> and <code>grep syscall /boot/System.map-4.20.*-generic</code> in the
report-Ln.pdf.</li>

<li>Report the addresses of sys-call-table, PLT, and GOT after the
install of the new kernel.</li>

<li>Examine 5 system programs of your choice.  Record their behavior
before and after the kernel switch.</li>
</ol>
</div>
</div>

<div id="outline-container-org9958590" class="outline-3">
<h3 id="org9958590"><span class="section-number-3">2.2</span> Task: Freeze a Few System Calls [40 points]</h3>
<div class="outline-text-3" id="text-2-2">
<ol class="org-ol">
<li>Add a new system call, named <code>freeze</code>, that takes a list of system
call numbers, and freezes them.  This will stay in effect until
next boot/ unfreeze.  [For now, we have no syscall to unfreeze.
See below.]</li>

<li>The list of syscall numbers is given as two arguments: <code>argc</code> a
positive integer, <code>int syscalls[]</code> of argc number of non-negative
integers.  Each integer <code>syscalls[i]</code> is the number of a system
call to be (or already) frozen.  The <code>freeze</code> syscall should not
complain if a syscall is already frozen &#x2013; merely ignore it.</li>

<li>Examine 5 system programs of your choice, that use one or more of
the syscalls frozen as above, and report on their behavior after
the freeze.</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-org72ba10e" class="outline-2">
<h2 id="org72ba10e"><span class="section-number-2">3</span> Bonus Tasks [Optional]</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-orgcbbd3d1" class="outline-3">
<h3 id="orgcbbd3d1"><span class="section-number-3">3.1</span> Bonus Task: Unfreeze System Call [20 points]</h3>
<div class="outline-text-3" id="text-3-1">
<ol class="org-ol">
<li>Add a new system call, named <code>unfreeze</code>, that takes a list of
system call numbers, and unfreezes them.  Do not complain if they
were not frozen.  Do log this.</li>

<li>The list of syscall numbers is given as above.  The <code>unfreeze</code>
syscall should not complain if a syscall is already enabled &#x2013;
merely ignore it.</li>

<li>Examine the same 5 system programs of your choice as above, and
verify that they work fine after the unfreeze.</li>
</ol>
</div>
</div>

<div id="outline-container-org00a7c2b" class="outline-3">
<h3 id="org00a7c2b"><span class="section-number-3">3.2</span> Bonus Task: White List of Programs [20 points]</h3>
<div class="outline-text-3" id="text-3-2">
<ol class="org-ol">
<li>Add a new system call, named <code>whitelist</code>, that takes a white list
of path names of programs.  Intent: The currently existing syscall
<code>execv</code> will no longer work unless the program is on this list.
Prior to invoking this system call, all path names are considered
to be white listed.</li>

<li>The input list of programs numbers is given in the <code>main(int argc,
   char *argv[])</code> standard form.</li>

<li>Focus on making this work <b>correctly</b>.  For now, ignore efficiency.
Assume that the list is in the hundreds.</li>

<li>Design and implement a simple system program that demonstrates the above.</li>
</ol>
</div>
</div>


<div id="outline-container-org4d7d5b5" class="outline-3">
<h3 id="org4d7d5b5"><span class="section-number-3">3.3</span> Bonus Task: Create a new /proc Entry for SysCalls  [20 points]</h3>
<div class="outline-text-3" id="text-3-3">
<ol class="org-ol">
<li>List (i) enabled, (ii) newly (since boot) added, (iii) frozen, and
(iv) deleted syscalls.  These should appear within
<code>/proc/sys/kernel/</code> .</li>
</ol>
</div>
</div>

<div id="outline-container-org6562e03" class="outline-3">
<h3 id="org6562e03"><span class="section-number-3">3.4</span> Bonus Task [Devious]: Create a Corrupted /proc.  [20 points]</h3>
<div class="outline-text-3" id="text-3-4">
<ol class="org-ol">
<li>Create a syscall, named <code>deproc</code>, that corrupts selected values
stored in the <code>/proc</code> pseudo file volume.  To avoid being detected,
it randomly choses some entries and corrupts them.  All others are
left in-tact.</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-org52698b2" class="outline-2">
<h2 id="org52698b2"><span class="section-number-2">4</span> Submission</h2>
<div class="outline-text-2" id="text-4">
<ol class="org-ol">
<li>[15 points] Lab Report quality and completeness.  [5 points]
Include a journal. By the hour.  You must follow the Lab Report
Template.  There should be a section on each of the tasks. A couple
of lines of an answer to each (implied/ explicit) question/
discussion item. Must number them as in this document.</li>

<li>Use good judgment in (i) what to submit and (ii) what to omit and
(iii) how long the report becomes.  Do not make the report way
longer than, say, 20 pages.  It is possible to remain under 20 pp,
and receive full score.  Lack of judgment earns <b>negative</b> points.</li>

<li>Submit few and relevant files of source code, and of text.  Always
interpret the results &#x2013; when before + after states are in context.</li>

<li>Submit a PDF file named exactly <code>Report-L6.pdf</code>, and a tarball <code>L6.tbz</code>
[created with <code>tar cfjvv L6.tbz source-files*</code> ]. (Scripts are used to check
various things &#x2013; so file names should obey such "rules".)</li>
</ol>
</div>
</div>

<div id="outline-container-org2e05a51" class="outline-2">
<h2 id="org2e05a51"><span class="section-number-2">5</span> References</h2>
<div class="outline-text-2" id="text-5">
<ol class="org-ol">
<li>Prabhaker Mateti, Lecture Notes and Videos on System Call Setup in
Linux, 2018.</li>

<li><a href="https://compas.cs.stonybrook.edu/~nhonarmand/courses/sp17/cse506/labs.html">https://compas.cs.stonybrook.edu/~nhonarmand/courses/sp17/cse506/labs.html</a>
Spring 2017 :: CSE 506 - Operating Systems.  "A crucial component of
the course is the labs."  Recommended Reading.</li>
</ol>
</div>
</div>


<div id="outline-container-org3a5c3e3" class="outline-2">
<h2 id="org3a5c3e3"><span class="section-number-2">6</span> End</h2>
<div class="outline-text-2" id="text-6">
</div>
</div>
</div>
<div id="postamble" class="status">
<hr size=1>Copyright &copy; 2018 <a href="http://www.wright.edu/~pmateti">www.wright.edu/~pmateti</a> &bull; 2019-10-31
</div>
</body>
</html>
