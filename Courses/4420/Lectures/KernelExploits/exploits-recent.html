<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Recent Kernel Exploits</title>
<!-- 2018-12-02 Sun 19:14 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Prabhaker Mateti" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<style> P,li {text-align: justify} code {color: brown;} @media screen {BODY {margin: 10%} }</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="../"> UP </a>
 |
 <a accesskey="H" href="../../Top/index.html"> HOME </a>
</div><div id="preamble" class="status">
<a href="../../"> ../../</a> | <a href=./>NoSlides</a>
</div>
<div id="content">
<h1 class="title">Recent Kernel Exploits</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Overview</a></li>
<li><a href="#sec-2">2. Stack Clash</a></li>
<li><a href="#sec-3">3. Spectre</a></li>
<li><a href="#sec-4">4. Meltdown</a>
<ul>
<li><a href="#sec-4-1">4.1. Overview</a></li>
<li><a href="#sec-4-2">4.2. Ideas</a></li>
<li><a href="#sec-4-3">4.3. Discussion</a></li>
</ul>
</li>
<li><a href="#sec-5">5. Dirty COW</a></li>
<li><a href="#sec-6">6. CVE-2017-18202 Local DoS Vulnerability</a></li>
<li><a href="#sec-7">7. CVE-2017-15126</a></li>
<li><a href="#sec-8">8. CVE-2017-1000253</a></li>
<li><a href="#sec-9">9. Other Vulnerabilities</a></li>
<li><a href="#sec-10">10. References</a></li>
<li><a href="#sec-11">11. End</a></li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Overview</h2>
<div class="outline-text-2" id="text-1">
<ol class="org-ol">
<li>Prerequisite: <a href="./exploits-overview.html">Kernel Exploits Overview</a>
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Stack Clash</h2>
<div class="outline-text-2" id="text-2">
<ol class="org-ol">
<li>A vulnerability in the memory management of OS was discovered in
2017, and named Stack Clash.  It can be exploited to execute
arbitrary code.
</li>

<li>Qualys stack-clash.txt [see refs] provided a technically detailed
description.
</li>

<li>"The idea of clashing the stack with another memory region is not
new: it was exploited a first time in 2005 and a second time
in 2010. After the 2010 exploit, Linux introduced a protection
against such exploits: the so-called stack guard-page. "
</li>

<li>To understand stack-guard page: Understand syscalls  mmap2,
mprotect, clone, etc.
</li>

<li>"The exploits and proofs of concept that we developed in the course
of our research are all Local Privilege Escalations: an attacker
who has any kind of access to an affected system can exploit the
Stack Clash vulnerability and obtain full root privileges."
</li>

<li><a href="https://www.cvedetails.com/cve/CVE-2017-1000364/">https://www.cvedetails.com/cve/CVE-2017-1000364/</a> "An issue was
discovered in the size of the stack guard page on Linux,
specifically a 4k stack guard page is not sufficiently large and
can be "jumped" over (the stack guard page is bypassed), this
affects Linux Kernel versions 4.11.5 and earlier (the stackguard
page was introduced in 2010)."  Reference.
</li>
<li><a href="https://www.exploit-db.com/docs/english/17784-recursive-stack-overflows.pdf">https://www.exploit-db.com/docs/english/17784-recursive-stack-overflows.pdf</a>
Jumping the Guard Page for Fun and Profit Recursive Stack Overflows
25 slides, 201x.  Recommended Reading.
</li>
</ol>
</div>
</div>


<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Spectre</h2>
<div class="outline-text-2" id="text-3">
<ol class="org-ol">
<li>Meltdown and Spectre exploit design errors in modern CPUs.
</li>

<li><a href="https://en.wikipedia.org/wiki/Speculative_execution">https://en.wikipedia.org/wiki/Speculative_execution</a>  Recommended Reading
</li>
<li><a href="https://spectreattack.com/spectre.pdf">https://spectreattack.com/spectre.pdf</a>
</li>
<li><a href="http://www.goodmath.org/blog/2018/01/03/a-gentle-explanation-of-the-intel-speculative-execution-cpu-bug/">http://www.goodmath.org/blog/2018/01/03/a-gentle-explanation-of-the-intel-speculative-execution-cpu-bug/</a>
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Meltdown</h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> Overview</h3>
<div class="outline-text-3" id="text-4-1">
<ol class="org-ol">
<li>"The security of computer systems fundamentally relies on memory
isolation, e.g., kernel address ranges are marked as non-accessible
and are protected from user access. In this paper, we present
Meltdown. Meltdown exploits side effects of out-of-order execution
on modern processors to read arbitrary kernel-memory locations
including personal data and passwords. Out-of-order execution is an
indispensable performance feature and present in a wide range of
modern processors. The attack is independent of the operating
system, and it does not rely on any software
vulnerabilities. Meltdown breaks all security assumptions given by
address space isolation as well as paravirtualized environments
and, thus, every security mechanism building upon this foundation.
On affected systems, Meltdown enables an adversary to read memory
of other processes or virtual machines in the cloud without any
permissions or privileges, affecting millions of customers and
virtually every user of a personal computer. We show that the
KAISER defense mechanism for KASLR has the important (but
inadvertent) side effect of impeding Meltdown. We stress that
KAISER must be deployed immediately to prevent large-scale
exploitation of this severe information leakage."  Abstract of:
</li>

<li>Lipp, Moritz, Michael Schwarz, Daniel Gruss, Thomas Prescher,
Werner Haas, Stefan Mangard, Paul Kocher, Daniel Genkin, Yuval
Yarom, and Mike Hamburg. "Meltdown." arXiv preprint
arXiv:1801.01207 (2018). <a href="https://meltdownattack.com/meltdown.pdf">https://meltdownattack.com/meltdown.pdf</a>,
16pp.  Reference.
</li>

<li>"Practical attacks that exploit speculative execution can leak
confidential information via microarchitectural side channels.  The
recently-demonstrated Spectre attacks leverage speculative loads
which circumvent access checks to read memory-resident secrets,
transmitting them to an attacker using cache timing or other covert
communication channels.  We introduce Spectre1.1, a new Spectre-v1
variant that leverages speculative stores to create speculative
buffer overflows.  Much like classic buffer overflows, speculative
out-ofbounds stores can modify data and code pointers. Data-value
attacks can bypass some Spectre-v1 mitigations, either directly or
by redirecting control flow. Control-flow attacks enable arbitrary
speculative code execution, which can bypass fence instructions and
all other software mitigations for previous speculative-execution
attacks. It is easy to construct return-oriented-programming (ROP)
gadgets that can be used to build alternative attack payloads.  We
also present Spectre1.2: on CPUs that do not enforce read/write
protections, speculative stores can overwrite readonly data and
code pointers to breach sandboxes.  We highlight new risks posed by
these vulnerabilities, discuss possible software mitigations, and
sketch microarchitectural mechanisms that could serve as hardware
defenses.  We have not yet evaluated the performance impact of our
proposed software and hardware mitigations. We describe the salient
vulnerability features and additional hypothetical attack scenarios
only to the detail necessary to guide hardware and software vendors
in threat analysis and mitigations.  We advise users to refer to
more user-friendly vendor recommendations for mitigations against
speculative buffer overflows or available patches."  Abstract of:
</li>

<li>Kiriansky, V. and Waldspurger, C., 2018. Speculative buffer
overflows: Attacks and defenses. arXiv preprint
arXiv:1807.03757. <a href="https://people.csail.mit.edu/vlk/spectre11.pdf">https://people.csail.mit.edu/vlk/spectre11.pdf</a>,
12pp.  Reference.
</li>
</ol>
</div>
</div>


<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> Ideas</h3>
<div class="outline-text-3" id="text-4-2">
<ol class="org-ol">
<li>Out-of-Order Execution
</li>
<li>Speculative Execution
</li>
<li>Address Space Isolation
</li>
<li>Paravirtualized Environments
</li>
<li>Required: Become familiar.
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3"><span class="section-number-3">4.3</span> Discussion</h3>
<div class="outline-text-3" id="text-4-3">
<ol class="org-ol">
<li>Meltdown and Spectre are CPU vulnerabilities.
</li>
<li>Should we expect an OS kernel to fix/ work-around such bugs?!
</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Dirty COW</h2>
<div class="outline-text-2" id="text-5">
<ol class="org-ol">
<li>COW == Copy-on-Write, a virtual memory technique.  Pages are shared
among processes, assuming read-only.  When a page changes, it is
unshared, and a separate page is copied.
</li>
<li><a href="https://dirtycow.ninja/">https://dirtycow.ninja/</a> CVE-2016-5195 is a
privilege escalation vulnerability in the Linux Kernel.
</li>

<li>"The Dirty COW exploit is a race condition that allows an attacker
to gain root access to any vulnerable system, and can even be
exploited from within a Docker container. This vulnerability
existed in the Linux kernel for nine years before it was
discovered."
</li>

<li>"A race condition was found in the way the Linux kernel's memory
subsystem handled the copy-on-write (COW) breakage of private
read-only memory mappings."
</li>

<li>download the dirtycow exploit from
<a href="https://www.exploit-db.com/exploits/40839/">https://www.exploit-db.com/exploits/40839/</a>
</li>
<li>more dirtycow exploits
<a href="https://github.com/dirtycow/dirtycow.github.io/wiki/PoCs">https://github.com/dirtycow/dirtycow.github.io/wiki/PoCs</a>
</li>

<li><a href="https://01.org/developerjourney/recipe/demonstrating-dirty-cow-exploit">https://01.org/developerjourney/recipe/demonstrating-dirty-cow-exploit</a>
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> CVE-2017-18202 Local DoS Vulnerability</h2>
<div class="outline-text-2" id="text-6">
<ol class="org-ol">
<li>Linux kernel is designed to kill a process when memory runs "low".
The <code>__oom_reap_task_mm</code> function in <code>mm/oom_kill.c</code> in the Linux
kernel mishandled gather operations, which allows attackers to
cause a denial of service (TLB entry leak or use-after-free) or
possibly have unspecified other impact by triggering a
<code>copy_to_user</code> call within a certain time window.
</li>

<li>"The pricing for an exploit might be around USD $5k-$25k at the
moment." [from <a href="https://vuldb.com/?id.113899">https://vuldb.com/?id.113899</a>]  Required Reading.
</li>

<li><a href="https://www.securityfocus.com/bid/103161">https://www.securityfocus.com/bid/103161</a> Local DoS Vulnerability.
Reference.
</li>
</ol>
</div>
</div>



<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> CVE-2017-15126</h2>
<div class="outline-text-2" id="text-7">
<ol class="org-ol">
<li>The security issue in this kernel vulnerability is local memory
corruption due to
<a href="http://cwe.mitre.org/data/definitions/416.html">use-after-free
(CWE-416)</a> coding sloppiness.  Such a bug can be exploited to
execute arbitrary code.
</li>

<li>The flaw was discovered in <code>fs/userfaultfd.c</code> in Linux kernel
related to <code>fork()</code> failure when dealing with event
messages. 
</li>

<li>The vulnerability and its fix have been published on a number of
security advisories.
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> CVE-2017-1000253</h2>
<div class="outline-text-2" id="text-8">
<ol class="org-ol">
<li>PIE <code>load_elf_binary</code> does not allocate sufficient space.
</li>

<li>Apllications are often built as a Position Independent Executable
(PIE).  The loader can allow part of that application's data
segment to map over the memory area reserved for its stack
resulting in corruption of the stack, with possible privilege
escalation.
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-9" class="outline-2">
<h2 id="sec-9"><span class="section-number-2">9</span> Other Vulnerabilities</h2>
<div class="outline-text-2" id="text-9">
<ol class="org-ol">
<li><a href="https://github.com/xairy/kernel-exploits">https://github.com/xairy/kernel-exploits</a> "A bunch of
proof-of-concept exploits for the Linux kernel" 2016 &#x2013; current.
</li>

<li>Kali Linux has a local copy of exploit-db exploits which make it
easier to search for local root exploits
</li>
</ol>
</div>
</div>



<div id="outline-container-sec-10" class="outline-2">
<h2 id="sec-10"><span class="section-number-2">10</span> References</h2>
<div class="outline-text-2" id="text-10">
<ol class="org-ol">
<li>Several refs are embedded in the above.
</li>
<li><a href="https://www.cvedetails.com/product/47/Linux-Linux-Kernel.html">https://www.cvedetails.com/product/47/Linux-Linux-Kernel.html</a> Linux
Kernel Vulnerability Statistics 1999 - 2018.  Required Visit.
</li>

<li><a href="https://blog.qualys.com/securitylabs/2017/06/19/the-stack-clash">https://blog.qualys.com/securitylabs/2017/06/19/the-stack-clash</a>;
<a href="https://www.qualys.com/2017/06/19/stack-clash/stack-clash.txt">https://www.qualys.com/2017/06/19/stack-clash/stack-clash.txt</a>
Qualys Security Advisory: The Stack Clash.    Reference.
</li>
<li><a href="https://www.cvedetails.com/cve/CVE-2017-1000364/">https://www.cvedetails.com/cve/CVE-2017-1000364/</a> Stack Clash.   Reference.
</li>

<li><a href="https://forum.xda-developers.com/android/software-hacking/development-stack-clash-eop-exploit-t3631001">https://forum.xda-developers.com/android/software-hacking/development-stack-clash-eop-exploit-t3631001</a>   Reference.
</li>

<li><a href="https://people.csail.mit.edu/vlk/spectre11.pdf">https://people.csail.mit.edu/vlk/spectre11.pdf</a>   Reference.
</li>
<li><a href="https://meltdownattack.com/">https://meltdownattack.com/</a>   Reference.
</li>

<li><a href="https://github.com/dirtycow/dirtycow.github.io/wiki/VulnerabilityDetails">https://github.com/dirtycow/dirtycow.github.io/wiki/VulnerabilityDetails</a>
The bug has existed since around 2.6.22 (released in 2007) and was
fixed on Oct 18, 2016. Reference.
</li>

<li>Spectre Mitigations <a href="https://www.wasmjit.org/blog/spectre-mitigations-part-1.html">https://www.wasmjit.org/blog/spectre-mitigations-part-1.html</a> + <a href="https://www.wasmjit.org/blog/spectre-mitigations-part-2.html">https://www.wasmjit.org/blog/spectre-mitigations-part-2.html</a>
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-11" class="outline-2">
<h2 id="sec-11"><span class="section-number-2">11</span> End</h2>
<div class="outline-text-2" id="text-11">
</div>
</div>
</div>
<div id="postamble" class="status">
<hr size=1>Copyright &copy; 2018 <a href="http://www.wright.edu/~pmateti">www.wright.edu/~pmateti</a> &bull; 2018-10-29
</div>
</body>
</html>
