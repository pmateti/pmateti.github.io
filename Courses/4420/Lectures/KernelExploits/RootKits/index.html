<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-09-18 Fri 06:05 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RootKits</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Prabhaker Mateti" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<style> P,li {text-align: justify} code {color: brown;} @media screen {BODY {margin: 10%} }</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="../"> UP </a>
 |
 <a accesskey="H" href="../../../Top/index.html"> HOME </a>
</div><div id="preamble" class="status">
<a href="../../"> ../../</a> | <a href=./index-slides.html>NoSlides</a>
</div>
<div id="content">
<h1 class="title">RootKits</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org229e7e7">1. Overview</a></li>
<li><a href="#orgcdacbf5">2. What Does a RootKit Do?</a></li>
<li><a href="#org6526397">3. Source Code of RootKits</a></li>
<li><a href="#org5d92cb3">4. A Lab on RootKits</a></li>
<li><a href="#org33454a8">5. References</a></li>
<li><a href="#org47fb880">6. End</a></li>
</ul>
</div>
</div>

<div id="outline-container-org229e7e7" class="outline-2">
<h2 id="org229e7e7"><span class="section-number-2">1</span> Overview</h2>
<div class="outline-text-2" id="text-1">
<ol class="org-ol">
<li>RootKits are collections of programs that an intruder would install
after having gained root access.  His overall goal is to hide his
future activity on that system.</li>

<li>RootKits have appeared for all major OS. Occasionally, overzealous
companies (e.g., Sony in 2005) have used rootkits embedded in their
products in an attempt to protect their intellectual property.</li>
</ol>
</div>
</div>

<div id="outline-container-orgcdacbf5" class="outline-2">
<h2 id="orgcdacbf5"><span class="section-number-2">2</span> What Does a RootKit Do?</h2>
<div class="outline-text-2" id="text-2">
<ol class="org-ol">
<li>A rootkit replaces existing and well-known programs with Trojans.</li>
<li>A rootkit would disable auditing when a certain user is logged on.</li>
<li>A rootkit would allow anyone to login if a certain backdoor password is used.</li>
<li>A rootkit could patch the kernel itself, allowing anyone to run privileged code if they use a special filename.</li>
</ol>
</div>
</div>

<div id="outline-container-org6526397" class="outline-2">
<h2 id="org6526397"><span class="section-number-2">3</span> Source Code of RootKits</h2>
<div class="outline-text-2" id="text-3">
<ol class="org-ol">
<li>A web search can easily find the source code of many rootkits.
E.g., LRK5 and Kernel Beast at <a href="http://packetstormsecurity.com/">http://packetstormsecurity.com/</a>.
They actually worked as rootkits at one time.  But, as of 2013,
these two do not compile without erros and actually work as
rootkits. Nevertheless, it is worthwhile to study their source
code.</li>

<li><a href="https://github.com/milabs/awesome-linux-rootkits">https://github.com/milabs/awesome-linux-rootkits</a> 2018 A list of
rootkits.</li>

<li><a href="https://github.com/chokepoint/Jynx2">https://github.com/chokepoint/Jynx2</a> 2012. JynxKit2 is an <code>LD_PRELOAD</code>
userland rootkit based on the original JynxKit. The backdoor has
been replaced with an "accept()" system hook.</li>

<li><a href="https://github.com/croemheld/lkm-rootkit">https://github.com/croemheld/lkm-rootkit</a> 2017 An LKM rootkit for
newer kernel versions.</li>

<li><a href="https://serverascode.com/2019/05/17/install-a-rootkit-for-testing.html">https://serverascode.com/2019/05/17/install-a-rootkit-for-testing.html</a> 2019</li>
</ol>
</div>

<div id="outline-container-org8205322" class="outline-3">
<h3 id="org8205322"><span class="section-number-3">3.1</span> How Do You Build a Pre-Written RootKit?</h3>
<div class="outline-text-3" id="text-3-1">
<ol class="org-ol">
<li>Obviously, no well known distro gives you a packaged rootkit rk for
you to <code>apt install rk</code>.</li>
<li>There are quite a few source code releases of rootkits.
Configuring them, and make-ing them is non-trivial, but not a
difficult task.</li>
<li>As an example, study <a href="../RootKits/rootkit-lrkiv.html">../RootKits/rootkit-lrkiv.html</a> It explores an
early, but capable, rootkit named Linux-Rootkit LRK4.  Src of LRK5
can be found.</li>
</ol>
</div>
</div>


<div id="outline-container-org04200c3" class="outline-3">
<h3 id="org04200c3"><span class="section-number-3">3.2</span> RootKit Detection</h3>
<div class="outline-text-3" id="text-3-2">
<ol class="org-ol">
<li>Recognizing and Recovering from Rootkit Attacks by
David O'Brien, 1996.  See link below.  Required reading.</li>

<li>There are several rootkit detection packages that are now standard
in various Linux distributions.  E.g., the following are in Debian/
Ubuntu: <code>/usr/sbin/chkrootkit</code>: POSIX shell script, executable;
<code>/usr/bin/rkhunter</code>: POSIX shell script, executable;
<code>/usr/sbin/unhide</code>: ELF 64-bit LSB executable, x86-64;</li>

<li>Read <a href="http://support.kaspersky.com/5353">http://support.kaspersky.com/5353</a> for a description of
their rootkit detection tools on Windows.</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-org5d92cb3" class="outline-2">
<h2 id="org5d92cb3"><span class="section-number-2">4</span> A Lab on RootKits</h2>
<div class="outline-text-2" id="text-4">
<p>
This lab is not scheduled for Fall 2020.  But highly educational.
Should we make this a "Bonus Lab"?
</p>

<p>
Objective: To experience rootkits and their detection.  You will be
  using two machines: one for compiling fresh copies of rootkit
  detection packages on a clean Linux machine, another running a
  rooted Linux system. 
</p>

<ol class="org-ol">
<li>Download onto a clean Linux machine (M1) the source code of two
rootkit detection packages among many available on the net. See the
Rootkit Detection section above.</li>
<li>Boot another machine (M2) from a Linux Live DVD. Corrupt this
system with a rootkit.  See the notes of the Source Code of
Rootkits section above.  Setup a new user named "intruder".</li>
<li>Login from M1 to M2 as user "intruder".  Use the machine M2.  Be
creative.</li>
<li>Which of the activity of user intruder are you (as root on M2) able
to observe with standard Unix utilities? Re-read the section
"Analysis of N.F.O Incident" above.</li>
<li>Download from M1 the rootkit detection packages.  Run these.  Write
a report on how you would clean M2 up.</li>
<li>Suppose you are the attacker.  What changes would you make to M2 so
that these rootkit detection tools become ineffective if they were
downloaded and built on M2 instead of M1?</li>
<li>There is a possibility that you may not succeed in installing a
rootkit.  Even so, (attempt to) do all the rest.</li>

<li>Bonus Points: Build the rootkit LRKn, n &gt;= 5.  Websearch for it.
Fix carefully so that there are no compilation errors.  Explore if
the two Trojans <code>ls</code> and <code>ps</code>, included in this rootkit, "do their
thing."  Suggest how the source code of LRKn could be revised for
modern Linuxes.</li>

<li>Bonus Points: Build the rootkit KBeast (websearch) so that there
are no compilation errors.  Explore if it "works."  Suggest how it
(the source code) could be revised.</li>

<li><a href="./rootKitLabGS.html">./rootKitLabGS.html</a> Grading Sheet 2013</li>
</ol>
</div>
</div>

<div id="outline-container-org33454a8" class="outline-2">
<h2 id="org33454a8"><span class="section-number-2">5</span> References</h2>
<div class="outline-text-2" id="text-5">
<ol class="org-ol">
<li>Wikipedia, Rootkit, <a href="http://en.wikipedia.org/wiki/Rootkit">http://en.wikipedia.org/wiki/Rootkit</a>. Required
reading.</li>

<li>Greg Hoglund, James Butler, Rootkits: Subverting the Windows
Kernel, 352 pages, Addison-Wesley, ISBN-10: 0321294319, 2005.  A
related free PDF of 240+ pages dated 2008 is
<a href="http://publicintelligence.net/hbgary-windows-rootkit-analysis-report/">http://publicintelligence.net/hbgary-windows-rootkit-analysis-report/</a>
Highly recommended reading.</li>

<li>Dave Dittrich, "Root Kits and hiding files/directories/processes
after a break-in", Date: 2002/01/05,
<a href="http://staff.washington.edu/dittrich/misc/faqs/rootkits.faq">http://staff.washington.edu/dittrich/misc/faqs/rootkits.faq</a> {This
link is broken, but do search for it.} Recommended reading.</li>

<li>TBD <a href="https://appsec-labs.com/ReFrameworker">https://appsec-labs.com/ReFrameworker</a> "A Managed Code Rootkit
(MCR) is deployed inside an application level virtual machine such
as those employed in Java, .NET, Dalvik, Python, &#x2026;  ."
April 2010.  Recommended visit.</li>

<li>Dong-Hoon You, Android Platform Based Linux Kernel Rootkit,
<a href="http://www.phrack.org/issues.html?issue=68&amp;id=6">http://www.phrack.org/issues.html?issue=68&amp;id=6</a> Phrack, 2012.
Recommended Reading.</li>

<li>fG, Revisiting Mac OS X Kernel Rootkits,
<a href="http://phrack.org/issues/69/7.html">http://phrack.org/issues/69/7.html</a>, 2016 Phrack, Volume 0x0f, Issue
0x45, Phile #0x07 of 0x10.  Recommended Reading.</li>

<li>Alex Matrosov, Eugene Rodionov, and Sergey Bratus, Rootkits and
Bootkits: Reversing Modern Malware and Next Generation Threats,
January 2019, 504 pp., ISBN-13: 978-1-59327-716-1
<a href="https://nostarch.com/rootkits">https://nostarch.com/rootkits</a>     Recommended Reading.</li>

<li><a href="https://0x00sec.org/t/kernel-rootkits-getting-your-hands-dirty/1485">https://0x00sec.org/t/kernel-rootkits-getting-your-hands-dirty/1485</a>
Jan 2017     Recommended Reading.</li>

<li><a href="https://www.la-samhna.de/library/rootkits/index.html">https://www.la-samhna.de/library/rootkits/index.html</a> 2002 {Still
good.}     Recommended Reading.</li>

<li><a href="https://www.blackhat.com/docs/us-16/materials/us-16-Leibowitz-Horse-Pill-A-New-Type-Of-Linux-Rootkit.pdf">https://www.blackhat.com/docs/us-16/materials/us-16-Leibowitz-Horse-Pill-A-New-Type-Of-Linux-Rootkit.pdf</a>
{Become familiar with balckhat.com.} Recommended Reading.</li>

<li><a href="https://blog.trendmicro.com/trendlabs-security-intelligence/skidmap-linux-malware-uses-rootkit-capabilities-to-hide-cryptocurrency-mining-payload/">https://blog.trendmicro.com/trendlabs-security-intelligence/skidmap-linux-malware-uses-rootkit-capabilities-to-hide-cryptocurrency-mining-payload/</a>
Sep 2019</li>
</ol>
</div>
</div>

<div id="outline-container-org47fb880" class="outline-2">
<h2 id="org47fb880"><span class="section-number-2">6</span> End</h2>
<div class="outline-text-2" id="text-6">
</div>
</div>
</div>
<div id="postamble" class="status">
<hr size=1>Copyright &copy; 2020 <a href="http://www.wright.edu/~pmateti">www.wright.edu/~pmateti</a> &bull; 2020-09-10
</div>
</body>
</html>
