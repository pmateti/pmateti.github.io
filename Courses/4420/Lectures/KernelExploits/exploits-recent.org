
# -*- mode: org -*-
#+date: 2018-10-29
#+TITLE: Recent Kernel Exploits
#+AUTHOR: Prabhaker Mateti
#+HTML_LINK_HOME: ../../Top/index.html
#+HTML_LINK_UP: ../
#+HTML_HEAD: <style> P,li {text-align: justify} code {color: brown;} @media screen {BODY {margin: 10%} }</style>
#+BIND: org-html-preamble-format (("en" "<a href=\"../../\"> ../../</a> | <a href=./>NoSlides</a>"))
#+BIND: org-html-postamble-format (("en" "<hr size=1>Copyright &copy; 2018 <a href=\"http://www.wright.edu/~pmateti\">www.wright.edu/~pmateti</a> &bull; %d"))
#+STARTUP:showeverything
#+OPTIONS: toc:2

* Overview

1. Prerequisite: [[./exploits-overview.org][Kernel Exploits Overview]]

* Stack Clash

1. A vulnerability in the memory management of OS was discovered in
   2017, and named Stack Clash.  It can be exploited to execute
   arbitrary code.

1. Qualys stack-clash.txt [see refs] provided a technically detailed
   description.

1. "The idea of clashing the stack with another memory region is not
   new: it was exploited a first time in 2005 and a second time
   in 2010. After the 2010 exploit, Linux introduced a protection
   against such exploits: the so-called stack guard-page. "

1. To understand stack-guard page: Understand syscalls  mmap2,
   mprotect, clone, etc.

1. "The exploits and proofs of concept that we developed in the course
   of our research are all Local Privilege Escalations: an attacker
   who has any kind of access to an affected system can exploit the
   Stack Clash vulnerability and obtain full root privileges."

1. https://www.cvedetails.com/cve/CVE-2017-1000364/ "An issue was
   discovered in the size of the stack guard page on Linux,
   specifically a 4k stack guard page is not sufficiently large and
   can be "jumped" over (the stack guard page is bypassed), this
   affects Linux Kernel versions 4.11.5 and earlier (the stackguard
   page was introduced in 2010)."  Reference.
1. https://www.exploit-db.com/docs/english/17784-recursive-stack-overflows.pdf
   Jumping the Guard Page for Fun and Profit Recursive Stack Overflows
   25 slides, 201x.  Recommended Reading.


* Spectre

1. Meltdown and Spectre exploit design errors in modern CPUs.

1. https://en.wikipedia.org/wiki/Speculative_execution  Recommended Reading
1. https://spectreattack.com/spectre.pdf
1. http://www.goodmath.org/blog/2018/01/03/a-gentle-explanation-of-the-intel-speculative-execution-cpu-bug/

* Meltdown

** Overview

1. "The security of computer systems fundamentally relies on memory
   isolation, e.g., kernel address ranges are marked as non-accessible
   and are protected from user access. In this paper, we present
   Meltdown. Meltdown exploits side effects of out-of-order execution
   on modern processors to read arbitrary kernel-memory locations
   including personal data and passwords. Out-of-order execution is an
   indispensable performance feature and present in a wide range of
   modern processors. The attack is independent of the operating
   system, and it does not rely on any software
   vulnerabilities. Meltdown breaks all security assumptions given by
   address space isolation as well as paravirtualized environments
   and, thus, every security mechanism building upon this foundation.
   On affected systems, Meltdown enables an adversary to read memory
   of other processes or virtual machines in the cloud without any
   permissions or privileges, affecting millions of customers and
   virtually every user of a personal computer. We show that the
   KAISER defense mechanism for KASLR has the important (but
   inadvertent) side effect of impeding Meltdown. We stress that
   KAISER must be deployed immediately to prevent large-scale
   exploitation of this severe information leakage."  Abstract of:

1. Lipp, Moritz, Michael Schwarz, Daniel Gruss, Thomas Prescher,
   Werner Haas, Stefan Mangard, Paul Kocher, Daniel Genkin, Yuval
   Yarom, and Mike Hamburg. "Meltdown." arXiv preprint
   arXiv:1801.01207 (2018). https://meltdownattack.com/meltdown.pdf,
   16pp.  Reference.

1. "Practical attacks that exploit speculative execution can leak
   confidential information via microarchitectural side channels.  The
   recently-demonstrated Spectre attacks leverage speculative loads
   which circumvent access checks to read memory-resident secrets,
   transmitting them to an attacker using cache timing or other covert
   communication channels.  We introduce Spectre1.1, a new Spectre-v1
   variant that leverages speculative stores to create speculative
   buffer overflows.  Much like classic buffer overflows, speculative
   out-ofbounds stores can modify data and code pointers. Data-value
   attacks can bypass some Spectre-v1 mitigations, either directly or
   by redirecting control flow. Control-flow attacks enable arbitrary
   speculative code execution, which can bypass fence instructions and
   all other software mitigations for previous speculative-execution
   attacks. It is easy to construct return-oriented-programming (ROP)
   gadgets that can be used to build alternative attack payloads.  We
   also present Spectre1.2: on CPUs that do not enforce read/write
   protections, speculative stores can overwrite readonly data and
   code pointers to breach sandboxes.  We highlight new risks posed by
   these vulnerabilities, discuss possible software mitigations, and
   sketch microarchitectural mechanisms that could serve as hardware
   defenses.  We have not yet evaluated the performance impact of our
   proposed software and hardware mitigations. We describe the salient
   vulnerability features and additional hypothetical attack scenarios
   only to the detail necessary to guide hardware and software vendors
   in threat analysis and mitigations.  We advise users to refer to
   more user-friendly vendor recommendations for mitigations against
   speculative buffer overflows or available patches."  Abstract of:

1. Kiriansky, V. and Waldspurger, C., 2018. Speculative buffer
   overflows: Attacks and defenses. arXiv preprint
   arXiv:1807.03757. https://people.csail.mit.edu/vlk/spectre11.pdf,
   12pp.  Reference.


** Ideas

1. Out-of-Order Execution
1. Speculative Execution
1. Address Space Isolation
1. Paravirtualized Environments
1. Required: Become familiar.

** Discussion

1. Meltdown and Spectre are CPU vulnerabilities.
1. Should we expect an OS kernel to fix/ work-around such bugs?!

* Dirty COW

1. COW == Copy-on-Write, a virtual memory technique.  Pages are shared
   among processes, assuming read-only.  When a page changes, it is
   unshared, and a separate page is copied.
1. https://dirtycow.ninja/ CVE-2016-5195 is a
   privilege escalation vulnerability in the Linux Kernel.

1. "The Dirty COW exploit is a race condition that allows an attacker
   to gain root access to any vulnerable system, and can even be
   exploited from within a Docker container. This vulnerability
   existed in the Linux kernel for nine years before it was
   discovered."

1. "A race condition was found in the way the Linux kernel's memory
   subsystem handled the copy-on-write (COW) breakage of private
   read-only memory mappings."

1. download the dirtycow exploit from
   https://www.exploit-db.com/exploits/40839/
1. more dirtycow exploits
   https://github.com/dirtycow/dirtycow.github.io/wiki/PoCs

1. https://01.org/developerjourney/recipe/demonstrating-dirty-cow-exploit

* CVE-2017-18202 Local DoS Vulnerability

1. Linux kernel is designed to kill a process when memory runs "low".
   The =__oom_reap_task_mm= function in =mm/oom_kill.c= in the Linux
   kernel mishandled gather operations, which allows attackers to
   cause a denial of service (TLB entry leak or use-after-free) or
   possibly have unspecified other impact by triggering a
   =copy_to_user= call within a certain time window.

1. "The pricing for an exploit might be around USD $5k-$25k at the
   moment." [from https://vuldb.com/?id.113899]  Required Reading.

1. https://www.securityfocus.com/bid/103161 Local DoS Vulnerability.
   Reference.



* CVE-2017-15126

1. The security issue in this kernel vulnerability is local memory
   corruption due to
   [[http://cwe.mitre.org/data/definitions/416.html][use-after-free
   (CWE-416)]] coding sloppiness.  Such a bug can be exploited to
   execute arbitrary code.

1. The flaw was discovered in =fs/userfaultfd.c= in Linux kernel
   related to =fork()= failure when dealing with event
   messages. 

1. The vulnerability and its fix have been published on a number of
   security advisories.

* CVE-2017-1000253

1. PIE =load_elf_binary= does not allocate sufficient space.

1. Apllications are often built as a Position Independent Executable
   (PIE).  The loader can allow part of that application's data
   segment to map over the memory area reserved for its stack
   resulting in corruption of the stack, with possible privilege
   escalation.

* Other Vulnerabilities

1. https://github.com/xairy/kernel-exploits "A bunch of
   proof-of-concept exploits for the Linux kernel" 2016 -- current.

1. Kali Linux has a local copy of exploit-db exploits which make it
   easier to search for local root exploits



* References

1. Several refs are embedded in the above.
1. https://www.cvedetails.com/product/47/Linux-Linux-Kernel.html Linux
   Kernel Vulnerability Statistics 1999 - 2018.  Required Visit.

1. https://blog.qualys.com/securitylabs/2017/06/19/the-stack-clash;
   https://www.qualys.com/2017/06/19/stack-clash/stack-clash.txt
   Qualys Security Advisory: The Stack Clash.    Reference.
1. https://www.cvedetails.com/cve/CVE-2017-1000364/ Stack Clash.   Reference.

1. https://forum.xda-developers.com/android/software-hacking/development-stack-clash-eop-exploit-t3631001   Reference.

1. https://people.csail.mit.edu/vlk/spectre11.pdf   Reference.
1. https://meltdownattack.com/   Reference.

1. https://github.com/dirtycow/dirtycow.github.io/wiki/VulnerabilityDetails
   The bug has existed since around 2.6.22 (released in 2007) and was
   fixed on Oct 18, 2016. Reference.

1. Spectre Mitigations https://www.wasmjit.org/blog/spectre-mitigations-part-1.html + https://www.wasmjit.org/blog/spectre-mitigations-part-2.html

* End
# Local variables:
# after-save-hook: org-html-export-to-html
# end:
