<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Wirth's Mark Errors</title>
<!-- 2018-07-24 Tue 07:45 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Prabhaker Mateti" />
<meta  name="description" content="CEG7380 Cloud Computing"
 />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<style> P,li {text-align: justify} code, pre {color: brown;} @media screen {BODY {margin: 10%} }</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/javascript" src="http://orgmode.org/mathjax/MathJax.js"></script>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
        //  config: ["MMLorHTML.js"], jax: ["input/TeX"],
            jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="../"> UP </a>
 |
 <a accesskey="H" href="../../"> HOME </a>
</div><div id="preamble" class="status">
<a href="../../"> ../../</a>
</div>
<div id="content">
<h1 class="title">Wirth's Mark Errors</h1>


<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Mark Errors</h2>
<div class="outline-text-2" id="text-1">
<p>
In processing an input line of text, a program we are working on
discovered errors.  Each error is recorded as a pair (p, e) of
numbers.  We wish to point to the p-th character that caused the
error, and print the error number e next to it.  Some times a single
position in the input line triggers multiple errors.  You are given a
list of these pairs, and the input line.  We need a procedure that
prints this line, and the error numbers below it, properly located.
Use no more lines than necessary.  [This is an Exercise from Niklaus
Wirth, Systematic Programming book, 197x]
</p>

<p>
<b>Spec by Example 1</b>
</p>

<div class="org-src-container">

<pre class="src src-bash">error list      :(4,1), (7,2), (10, 2), (20, 2), (23, 2).
column numbers  :1234567890123456789012345
line of text    : Thos broplem is peenuds.
line of errors  :   ^1 ^2 ^2        ^2 ^2
</pre>
</div>

<p>
<b>Spec by Example 2</b>
</p>
<div class="org-src-container">

<pre class="src src-bash">error list      :(5, 9), (13, 9), (13, 787), (18,94), (18, 126), (25,73),
(continued)     :(30, 9), (30, 23), (30, 26), (39, 9), (40, 742).
column numbers  :12345678901234567890123456789012345678901234
line of text    : if x &gt; 0 anf y +) then 0 := x else f(x.y) ;
line of errors  :    ^9      ^9   ^94,126^73  ^9,23,26 ^9
line of errors  :            ^787                       ^742
</pre>
</div>

<p>
[We can never specify software using examples.  But, this is popular
because it quickly communicates essential features.  Where it
typically fails is in the "edge" cases.]
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> "Solutions"</h2>
<div class="outline-text-2" id="text-2">
<ol class="org-ol">
<li>Several <a href="./mark-error-pos.cpp.html">"solutions"</a> are presented.  The code given here is expected
to solve a simpler version (read the comments) S1 of the above
problem.  Your task: Figure out which ones, if any, are correct.
</li>

<li>Note that this code uses <code>cout</code> to construct <code>out[]</code>.  What is
output cannot then be changed later.
</li>

<li>The problem can be further simplified if we build <code>out[]</code> in memory,
and print it all at once.
</li>
</ol>
</div>
</div>


<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Teaching</h2>
<div class="outline-text-2" id="text-3">
<ol class="org-ol">
<li>This problem can be used in teaching. For different purposes.
</li>

<li>Develop the requirements analysis, and rigorous specs for the Mark
Error problem as described in Section 1.
</li>

<li>Develop pre- post- conditions for each solution, and loop
invariants for every loop.  Even incorrect programs have all these!
</li>

<li>What was the thinking behind these "solutions"?
</li>

<li>Can you figure out which ones go into an infinite loop <b>without</b> testing it?
</li>

<li>Is this a "debugging" problem?
</li>

<li>Having identified the "correct" solutions, develop it further to
solve the specs of  Section 1. Mark Errors.  Look up: Agile
Iterative Development.
</li>

<li>Can this be done in one-pass?  Always?
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Requirements Clarifications</h2>
<div class="outline-text-2" id="text-4">
<ol class="org-ol">
<li>Q: Is the array pos[] as in "solutions" sorted (ltor)? Are these indices
guaranteed to be those of txt? A: Yes, and yes.
</li>

<li>Q: Is txt[] just one line? A: Yes. The txt[] has "ordinary"
characters (only); no '\t', '\n', and such.
</li>

<li>Q: How large are the numbers? A: Assume that the numbers are
unsigned 16-bit.  C++ ushort will do.
</li>

<li>Make (further) reasonable/ sympathetic assumptions.  This is not a problem cooked
up to raise your awareness of requirements analyses.  It is a
"develop a correct solution to what is stated" problem.
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Simpler Version S1 of the Problem</h2>
<div class="outline-text-2" id="text-5">
<ol class="org-ol">
<li>The following three lines are extracted from the source code given.

<pre class="example">
int  pos[] = { 3, 6, 9, 19, 22 };
char txt[] = "Thes broplem is peenuds.";   // example input
char out[] = "  *  *  *         *  *";     // expected output
</pre>
</li>

<li>S1: We should have out[y] == '*' for every y
given in pos[].  All the rest of out[] should be blanks.  Not
rigorously stated, but pretty good.
</li>

<li>Like we did in the Dutch National Flag problem, use this as the
post condition of the <code>markErrorPos</code> method, and use a weakened
version of the post as a loop invariant for the code yet to be
designed.  
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> A Solution for S1 that is/ better-be Correct-by-Design</h2>
<div class="outline-text-2" id="text-6">
</div><div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1"><span class="section-number-3">6.1</span> Make S1 Rigorous</h3>
<div class="outline-text-3" id="text-6-1">
<ol class="org-ol">
<li>Assume that the starting index of arrays is a 1, not 0 (even though
this is not Pascal).  To keep it less confusing, we are conforming
to the code given.  But, the indices i, j, k used below are
unrelated to those of the code.
</li>

<li>Weakest Pre Condition P
<ol class="org-ol">
<li>Def L == (sizeof(txt)/sizeof(char))
</li>
<li>Def n == (sizeof(pos)/sizeof(int))
</li>
<li>sorted(pos), which is-defined-as pos[ 1] &lt; pos [ 2] &lt; &#x2026; &lt; pos[n].
</li>
<li>0 &lt; pos[i] &lt; L+1 for all indices i of pos[].
</li>
<li>For ease of use, let us call the conjunction (AND-ing) of all
the above as P.
</li>
</ol>
</li>

<li>Post Condition Q
<ol class="org-ol">
<li>Think of out[] as modeling the stdout produced by our markErrorPos().
</li>
<li>out[j] is either ' ' (a blank) or '*', for all its indices j.
</li>
<li>out[pos[i]] == '*' for all indices i of pos[].
</li>
<li>For ease of use, let us call the conjunction (AND-ing) of all
the above as Q.
</li>
</ol>
</li>

<li>To keep things simple, we will continue to assume that pos[], txt[]
and out[] are global arrays.  Later, we will model as follows:
{out[] := markErrorPos(txt, pos);}
</li>

<li>The spec S1 is {P} markErrorPos() {Q}
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-6-2" class="outline-3">
<h3 id="sec-6-2"><span class="section-number-3">6.2</span> A Loop Invariant from S1</h3>
<div class="outline-text-3" id="text-6-2">
<ol class="org-ol">
<li>Based on our "experience", we are expecting to design an iterative
algorithm for markErrorPos().
</li>

<li>Take the Q above, and revise it as Q(k), a function of k, where k
is a valid index of pos[].  Item 3 of Q above is weakened:
<ol class="org-ol">
<li>out[pos[i]] == '*' for indices i of pos[], 0 &lt; i &lt; k
</li>
<li>Imagine that out[] starts out as an empty string, and grows.
</li>
<li>Only out[1 .. pos[i]] is defined (produced) so far.
</li>
</ol>
</li>

<li>Based on this Q(k), we formulate the following.
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-6-3" class="outline-3">
<h3 id="sec-6-3"><span class="section-number-3">6.3</span> Tentative Algorithm</h3>
<div class="outline-text-3" id="text-6-3">
<pre class="example">
out := ""; z := length-of(out);
n := length-of(pos);
for (k := 1; k &lt; n; k++) {
   assert Q(k) &amp;&amp; 0 &lt; k &lt; n &amp;&amp; 0 &lt;= z == length-of(out) &lt; pos[k];
   while (z &lt; pos[k]) {
      assert Q(k) &amp;&amp; 0 &lt;= k &lt; n &amp;&amp; 0 &lt;= z == length-of(out) &lt; pos[k];
      out += " "; z ++;
   }
   out += "*"; z ++;
}
</pre>

<p>
Written in a VHLL of our own making.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Full Version Spec S2</h2>
<div class="outline-text-2" id="text-7">
<p>
This section presents the spec S2 for the full version of the problem
as described in Section 1 above.
</p>

<ol class="org-ol">
<li>Read the symbol =: as "yields".
</li>
<li>Exercise: Define itostr.  Ex: itostr(742) =: "742", no leading zeros, only
digits 0 to 9, input assumed to be decimal.
</li>

<li>Exercise: Define toString. Ex: toString(40, 742) =: b<sup>39</sup> + "^" +
itostr(742); b stands for a blank, b<sup>39</sup> is a string of 39 spaces, +
is overloaded as string catenation.
</li>
</ol>
</div>

<div id="outline-container-sec-7-1" class="outline-3">
<h3 id="sec-7-1"><span class="section-number-3">7.1</span> Overlays</h3>
<div class="outline-text-3" id="text-7-1">
<ol class="org-ol">
<li>We use the idea of overlaid overhead projection transparencies of
yesteryear.
</li>

<li>overlay(s, t) =: u, where s, t and u are all strings.
<ol class="org-ol">
<li>Intuitively, t is overlaid on s to yield u. (Just for now,
assume that t is longer than equal in length). Only where t[i] is a
blank will the s[i] show through in u[i].
</li>
<li>length-of(u) is max (length-of(s), length-of(t))
</li>
<li>For the purpose of the defs below:
<ol class="org-ol">
<li>s[i] is b if i &gt; length-of(s) ; starting index is 1.
</li>
<li>t[i] is b if i &gt; length-of(t) ; starting index is 1.
</li>
</ol>
</li>
<li>u[i] is s[i] if t[i] == b 
</li>
<li>u[i] is t[i] if t[i] != b
</li>
</ol>
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-7-2" class="outline-3">
<h3 id="sec-7-2"><span class="section-number-3">7.2</span> markErrorPos</h3>
<div class="outline-text-3" id="text-7-2">
<ol class="org-ol">
<li>markErrorPos(txt, pos) =: a string
</li>
<li>out is overlay(s, t), where s is tostring(pos[ 1].p, and t is
markErrorPos(txt, pos[ 2..n])
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-7-3" class="outline-3">
<h3 id="sec-7-3"><span class="section-number-3">7.3</span> Commentary</h3>
<div class="outline-text-3" id="text-7-3">
<ol class="org-ol">
<li>This is not declarative, is it?
</li>
<li>This looks like a program written in functional style, no?
</li>
<li>Did we assume that strings end with a NUL character?
</li>
<li>Did we take care of multiple lines of mark errors?
</li>
<li>When we do need multiple lines, how to make sure we use a minimal number?
</li>
<li>If we were to implement this spec as-is, it will be pretty
inefficient.  This is a good quality of a spec!
</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> References</h2>
<div class="outline-text-2" id="text-8">
<ol class="org-ol">
<li>Niklaus Wirth, Systematic Programming: An Introduction (book), Prentice
Hall, 1973. 208 pages. ISBN-10: 0138803692; ISBN-13: 978-0138803698
</li>
</ol>
</div>
</div>
</div>
<div id="postamble" class="status">
<hr size=1>Copyright &copy; 2016 &bull; <a href="http://www.wright.edu/~pmateti"> www.wright.edu/~pmateti</a> &bull; 2016-06-20
</div>
</body>
</html>
