<!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><b><font color="#000000">real_main</font></b><font color="#990000">()</font> <font color="#FF0000">{</font>
  <b><font color="#000000">eval</font></b><font color="#990000">(</font><font color="#FF0000">"source"</font><font color="#990000">,</font> <b><font color="#000000">source</font></b><font color="#990000">());</font>
  <b><font color="#000000">eval</font></b><font color="#990000">(</font><font color="#FF0000">"sink"</font><font color="#990000">,</font> <b><font color="#000000">sink</font></b><font color="#990000">());</font>
<font color="#FF0000">}</font>


<b><font color="#000000">source</font></b><font color="#990000">()</font> <font color="#FF0000">{</font>
  <font color="#009900">int</font> i<font color="#990000">,</font> out_index<font color="#990000">=</font><font color="#993399">0</font><font color="#990000">;</font>

  <b><font color="#0000FF">for</font></b> <font color="#990000">(</font>i <font color="#990000">=</font> <font color="#993399">5</font><font color="#990000">;</font> i <font color="#990000">&lt;</font> LIMIT<font color="#990000">;</font> i <font color="#990000">+=</font> <font color="#993399">2</font><font color="#990000">)</font> <b><font color="#000000">out</font></b><font color="#990000">(</font><font color="#FF0000">"seg"</font><font color="#990000">,</font> <font color="#993399">3</font><font color="#990000">,</font> out_index<font color="#990000">++,</font> i<font color="#990000">);</font>
  <b><font color="#000000">out</font></b><font color="#990000">(</font><font color="#FF0000">"seg"</font><font color="#990000">,</font> <font color="#993399">3</font><font color="#990000">,</font> out_index<font color="#990000">,</font> <font color="#993399">0</font><font color="#990000">);</font>
<font color="#FF0000">}</font>


<b><font color="#000000">sink</font></b><font color="#990000">()</font> <font color="#FF0000">{</font>
  <font color="#009900">int</font>    in_index<font color="#990000">=</font><font color="#993399">0</font><font color="#990000">,</font> num<font color="#990000">,</font> <b><font color="#000000">pipe_seg</font></b><font color="#990000">(),</font> prime<font color="#990000">=</font><font color="#993399">3</font><font color="#990000">,</font> prime_count<font color="#990000">=</font><font color="#993399">2</font><font color="#990000">;</font>
  <b><font color="#0000FF">while</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">)</font> <font color="#FF0000">{</font>
    <b><font color="#000000">in</font></b><font color="#990000">(</font><font color="#FF0000">"seg"</font><font color="#990000">,</font> prime<font color="#990000">,</font> in_index<font color="#990000">++,</font> <font color="#990000">?</font> num<font color="#990000">);</font>
    <b><font color="#0000FF">if</font></b> <font color="#990000">(!</font>num<font color="#990000">)</font> <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
    <b><font color="#0000FF">if</font></b> <font color="#990000">(</font>num <font color="#990000">%</font> prime<font color="#990000">)</font> <font color="#FF0000">{</font>
      <font color="#990000">++</font>prime_count<font color="#990000">;</font>
      <b><font color="#0000FF">if</font></b> <font color="#990000">(</font>num<font color="#990000">*</font>num <font color="#990000">&lt;</font> LIMIT<font color="#990000">)</font> <font color="#FF0000">{</font>
	<b><font color="#000000">eval</font></b><font color="#990000">(</font><font color="#FF0000">"pipe seg"</font><font color="#990000">,</font> <b><font color="#000000">pipe_seg</font></b><font color="#990000">(</font>prime<font color="#990000">,</font> num<font color="#990000">,</font> in_index<font color="#990000">));</font>
	prime <font color="#990000">=</font> num<font color="#990000">;</font>
	in_index <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
      <font color="#FF0000">}</font>
    <font color="#FF0000">}</font>
  <font color="#FF0000">}</font>
  <b><font color="#000000">printf</font></b><font color="#990000">(</font><font color="#FF0000">"count: %d.</font><font color="#CC33CC">\n</font><font color="#FF0000">"</font><font color="#990000">,</font> prime_count<font color="#990000">);</font>
<font color="#FF0000">}</font>


<b><font color="#000000">pipe_seg</font></b><font color="#990000">(</font>prime<font color="#990000">,</font> next<font color="#990000">,</font> in_index<font color="#990000">)</font> <font color="#FF0000">{</font>
  <font color="#009900">int</font> num<font color="#990000">,</font> out_index<font color="#990000">=</font><font color="#993399">0</font><font color="#990000">;</font>
  <b><font color="#0000FF">while</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">)</font> <font color="#FF0000">{</font>
    <b><font color="#000000">in</font></b><font color="#990000">(</font><font color="#FF0000">"seg"</font><font color="#990000">,</font> prime<font color="#990000">,</font> in_index<font color="#990000">++,</font> <font color="#990000">?</font> num<font color="#990000">);</font>
    <b><font color="#0000FF">if</font></b> <font color="#990000">(!</font>num<font color="#990000">)</font> <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
    <b><font color="#0000FF">if</font></b> <font color="#990000">(</font>num <font color="#990000">%</font> prime<font color="#990000">)</font> <b><font color="#000000">out</font></b><font color="#990000">(</font><font color="#FF0000">"seg"</font><font color="#990000">,</font> next<font color="#990000">,</font> out_index<font color="#990000">++,</font> num<font color="#990000">);</font>
  <font color="#FF0000">}</font>
  <b><font color="#000000">out</font></b><font color="#990000">(</font><font color="#FF0000">"seg"</font><font color="#990000">,</font> next<font color="#990000">,</font> out_index<font color="#990000">,</font> num<font color="#990000">);</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">/* eof- */</font></i>
</tt></pre>
