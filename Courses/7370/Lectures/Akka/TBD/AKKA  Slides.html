<!DOCTYPE html>
	<html class="decks fullscreen">
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title>AKKA: Slides</title>
		<meta name="description" content="Slides">
		<link rel="stylesheet" href="/assets/slides/slides.css" />
		<link href="//slid.es/assets/application-b130fa6dc03cd444c931211c7334726d.css" media="all" rel="stylesheet" type="text/css" />
		<link href="//slid.es/assets/deck-3bc6504f40775c33fd701b9d9a5c2be4.css" media="all" rel="stylesheet" type="text/css" />
		<script src="//slid.es/assets/modernizr-8de39a011a7fbb0c52e24f7f6a30f4e7.js" type="text/javascript"></script>
		<meta content="authenticity_token" name="csrf-param" />
<meta content="M2N/NkQ6h5CDOqbGjg7hz4Ej7/l9XPPoebJbQRh9/sI=" name="csrf-token" />
		<script type="text/javascript">
  var analytics=analytics||[];analytics.load=function(e){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+e+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n);var r=function(e){return function(){analytics.push([e].concat(Array.prototype.slice.call(arguments,0)))}},i=["identify","track","trackLink","trackForm","trackClick","trackSubmit","pageview","ab","alias","ready"];for(var s=0;s<i.length;s++)analytics[i[s]]=r(i[s])};
  analytics.load('8t66f1pnq9');
</script>
		<style id="user-css-output" type="text/css"></style>
	<script type="text/javascript">var NREUMQ=NREUMQ||[];NREUMQ.push(["mark","firstbyte",new Date().getTime()]);</script></head>
	<body class="reveal-viewport theme-font-league theme-color-lila-yellow">
		<div class="reveal">
			<div class="slides">
				<section><h1><br></h1>
<img src="https://s3.amazonaws.com/media-p.slid.es/uploads/gaelmartin/images/163601/logo_dropshadow.png" style="width: 322.40618093966384px; height: 254.8034808442024px; max-height: none; max-width: none;"><div>Brown Bag Session 27/11/13</div>
<div>Gael Martin</div></section><section><h2>What is AKKA?</h2>
<blockquote>"Akka is a toolkit and runtime for building highly concurrent, distributed, and fault tolerant event-driven applications on the JVM" (www.akka.io)</blockquote>
<div><br></div>Also is:<div>
<blockquote><span>It is the name of a beautiful Swedish mountain up in the northern part of Sweden called Laponia. The mountain is also sometimes called "The Queen of Laponia"</span></blockquote>
<div><br></div>
</div>
<div><i>Akka is available for JAVA and SCALA</i></div></section><section><h2>Actor Model</h2>
<div><font style="font-size: 32px;">Created by Carl Hewitt some 35 years ago at MIT, the Actor model is a good way to implement systems that involve multiple simultaneous communications.<br></font></div>
<div><br></div>
<div style="text-align: center;"><font style="font-size: 32px;">The actor model in computer science is a mathematical model of concurrent computation that treats "actors" as the universal primitives of concurrent digital computation.</font></div>
<div style="text-align: center;"><font style="font-size: 32px;"><br></font></div>
<div style="text-align: center;">
<font style="font-size: 32px;"> In response to a message that it receives, an actor can make local decisions, create more actors, send more messages, and determine how to respond to the next message receive.</font><br>
</div></section><section><h2>I/O Sync - vs - I/O ASYNC</h2>
<div>
<b><font color="#45818e">SYNC:</font></b> One thread is dedicated to each request, and that thread does all the processing for the request until a response is sent. Any I/O, such as a call to a remote service, is typically synchronous, which means the thread will become blocked and sit around idle until the I/O completes.<br>
</div>
<div><br></div>
<div>
<font color="#45818e"><b>ASYNC</b>:</font> Typically use only a single thread per CPU core. The idea is to ensure that these scarce threads are never blocked: all I/O is asynchronous, so instead of waiting, the thread can process other requests, and only come back to the current one when the response from the I/O call is ready.</div>
<div><br></div></section><section><h2>i/o SYNC Issues!</h2>
<div>
<b><i><font style="font-size: 42px;" color="#45818e">"sizing the thread pool"</font></i></b><br>
</div>
<div>
<ul>
<li>
<span style="text-align: center;">Not enough threads -&gt; no more requests can be processed, even if threads idles waiting.</span><br>
</li>
<li>
<span style="text-align: center;">Too many threads -&gt; too much memory usage overhead becomes costly</span><br>
</li>
</ul>
<div><b><i><font style="font-size: 42px;" color="#45818e"><br></font></i></b></div>
<div>
<b><i><font style="font-size: 42px;" color="#45818e">"dead lock, live lock"</font></i></b><br>
</div>
</div>
<div>
<ul><li><span style="text-align: center;">Threads waiting for each other to complete</span></li></ul>
<div><b><i><font style="font-size: 42px;" color="#45818e"><br></font></i></b></div>
<div>
<b><i><font style="font-size: 42px;" color="#45818e">"race conditions" AKA "it works on my machine"</font></i></b><br>
</div>
</div>
<div><ul>
<li>
<span style="text-align: center;">Sharing data (mutable) between threads</span><br>
</li>
<li>
<span style="text-align: center;">Synchronising  threads incurs more waiting/blocking</span><br>
</li>
</ul></div>
<div><br></div>
<div><br></div></section><section><h2>I/O ASYNC WORLD</h2>
<div><font color="#45818e" style="font-size: 42px;"><i><b>"Less latency"</b></i></font></div>
<div>no more waiting for all actions to complete sequentially.</div>
<div><br></div>
<div><b><font color="#45818e" style="font-size: 42px;"><i>"Less threads"</i></font></b></div>
<div> no more blocked threads doing not much</div>
<div><br></div>
<div><b><font color="#45818e" style="font-size: 42px;"><i>"More throughput"</i></font></b></div>
<div> same amount of thread able to handle more requests</div>
<div><br></div>
<div><font color="#45818e" style="font-size: 42px;"><b><i>"More scalable"</i></b></font></div>
<div> more cores -&gt; more threads -&gt; more requests</div>
<div><br></div></section><section><h2>WHAT is an ACTOR?</h2>
<div>
<img src="https://s3.amazonaws.com/media-p.slid.es/uploads/gaelmartin/images/165780/actor.png" style="width: 519.6380544909421px; height: 190.11217731995993px; max-height: none; max-width: none;"><br>
</div>
<div><ul>
<li>
<span style="text-align: center;">An active entity with an Inbox = Queue</span><br>
</li>
<li>
<span style="text-align: center;">A State  =  Storage</span><br>
</li>
<li>
<span style="text-align: center;">State is not shared, only accessible through...</span><br>
</li>
<li>
<span style="text-align: center;">...messages passing</span><br>
</li>
<ul>
<li><span style="text-align: center;">one message is executed at a time</span></li>
<li><span style="text-align: center;">messages are processed sequentially </span></li>
</ul>
</ul></div></section><section><h2>WHAT CAN I USE ACTOR FOR?</h2>
<div><font style="font-size: 54px;" color="#45818e">Actors can be an alternative to:</font></div>
<div><br></div>
<div><ul>
<li>
<span style="text-align: center;">A thread</span><br>
</li>
<li>
<span style="text-align: center;">An object or Component</span><br>
</li>
<li>
<span style="text-align: center;">A callback or listener</span><br>
</li>
<li>
<span style="text-align: center;">A singleton or service</span><br>
</li>
<li>
<span style="text-align: center;">A router / load balancer / pool</span><br>
</li>
<li>
<span style="text-align: center;">A Java EE session bean</span><br>
</li>
<li><span style="text-align: center;">A out of process service</span></li>
<li><span style="text-align: center;">A Finite State Machine</span></li>
</ul></div>
<div><br></div>
<div><br></div>
<div><br></div></section><section><h2>ACtors operations</h2>
<div><br></div>
<div><ol>
<li><font style="font-size: 72px;"><span style="text-align: center;">CREATE</span><br></font></li>
<li><font style="font-size: 72px;"><span style="text-align: center;">SEND</span><br></font></li>
<li><font style="font-size: 72px;"><span style="text-align: center;">BECOME</span><br></font></li>
<li>
<span style="text-align: center;"><font style="font-size: 72px;">SUPERVISE</font></span><br>
</li>
</ol></div></section><section><h2>CREATE</h2>
<div><br></div>
<div>
<ul><li>
<span style="text-align: center;">Extremely lightweight (2.7 Million per Gb RAM)</span><br>
</li></ul>
<div><br></div>
<ul><li>
<span style="text-align: center;">Very strong encapsulation - encapsulates:</span><br>
</li></ul>
</div>
<div>
<div>
<ol>
<li>
<span style="text-align: center;">state</span><br>
</li>
<li>
<span style="text-align: center;">behaviour</span><br>
</li>
<li><span style="text-align: center;">inbox</span></li>
</ol>
<div><br></div>
</div>
<div>
<ul><li>
<span style="text-align: center;">State &amp; Behaviour is indistinguishable from each other</span><br>
</li></ul>
<div><br></div>
<ul><li>
<span style="text-align: center;">Observe state is by sending an actor a message </span><br>
</li></ul>
</div>
</div></section><section><h2>DEFINE</h2>
<pre><code>public class Greeting implements Serializable {
  public final String who;
  public Greeting(String who) {
    this.who = who;
  }
}</code><code>
public class GreetingActor extends UntypedActor {
  LoggingAdapter log = Logging.getLogger(getContext().system(), this);
  public void onReceive(Object message) throws Exception {
    if (message instanceof Greeting)
      log.info("Hello {}", ((Greeting) message).who);
  }
} </code></pre>
<h2>CREATE</h2>
<div><pre style="font-style: normal; font-variant: normal; width: 861.8338623046875px;"><code>ActorSystem system = ActorSystem.create("MySystem");</code><code>
ActorRef greeter = system.actorOf(new Props(GreetingActor.class), "greeter"); </code></pre></div></section><section><h2>ACTOR HIERARCHY</h2>
<div>Actors can form hierarchies<br>
</div>
<div>
<img src="https://s3.amazonaws.com/media-p.slid.es/uploads/gaelmartin/images/165850/actor_hierarchy.png" style="width: 752.0648546816908px; height: 413.37555186223926px; max-height: none; max-width: none;"><br>
</div>
<div>￼Name resolution - like a file-system<br>
</div></section><section><h2>SEND</h2>
<div><div>
<ul><li>
<span style="text-align: center;">Sends a message to an Actor</span><br>
</li></ul>
<div><br></div>
<ul><li>
<span style="text-align: center;">Asynchronous and Non-blocking - Fire-forget</span><br>
</li></ul>
<div><br></div>
<ul><li>
<span style="text-align: center;">Everything happens Reactively</span><br>
</li></ul>
<div><br></div>
<ul><li>
<span style="text-align: center;">An Actor is passive until a message is sent to it, which triggers behaviour within the Actor</span><br>
</li></ul>
<div><br></div>
<ul><li>
<span style="text-align: center;">Everything is asynchronous and lockless</span><br>
</li></ul>
</div></div></section><section><h2>SEND</h2>
<div><br></div>
<div><pre><code><font color="#666666">ActorRef greeter = system.actorOf(new Props(GreetingActor.class), "greeter"); </font>
greeter.tell(new Greeting("Charlie Parker")); </code></pre></div>
<h1><span style="font-size: 72px; text-transform: uppercase;">REPLY</span></h1>
<div><pre><code><font color="#666666">public class GreetingActor extends UntypedActor {
  LoggingAdapter log = Logging.getLogger(getContext().system(), this);
  public void onReceive(Object message) throws Exception {
    if (message instanceof Greeting)
      log.info("Hello {}", ((Greeting) message).who);</font>
      getSender.tell("Thanks");
 <font color="#666666"> }
} </font> </code></pre></div></section><section><h2>BECOME</h2>
<div><div>
<ul><li>
<span style="text-align: center;">Dynamically redefines Actor’s behaviour</span><br>
</li></ul>
<div><br></div>
<ul><li>
<span style="text-align: center;">Triggered reactively by receive of message</span><br>
</li></ul>
<div><br></div>
<ul><li>
<span style="text-align: center;">In a type system analogy it is as if the object changed type - changed interface, protocol &amp; implementation</span><br>
</li></ul>
<div><br></div>
<ul><li>
<span style="text-align: center;">Will now react differently to the messages it receives</span><br>
</li></ul>
<div><br></div>
<ul><li>
<span style="text-align: center;">Behaviours are stacked &amp; can be pushed and popped</span><br>
</li></ul>
</div></div></section><section><h2>WHY BECOME?</h2>
<div>
<ul><li><span style="text-align: center;"> Implement an FSM (Finite State Machine)</span></li></ul>
<div><br></div>
<span><ul><li>
<span style="text-align: center;">Spawn up generic Actor that can become whatever the Master currently needs</span><br>
</li></ul></span><div style="text-align: left;"><br></div>
<ul><li>
<span style="text-align: center;">Let a highly contended Actor adaptively transform himself into an Actor Pool or a Router</span><br>
</li></ul>
<div><br></div>
<div><ul><li>
<span style="text-align: center;">Implement graceful degradation</span><br>
</li></ul></div>
</div></section><section><h2>BECOME - BEHAVIOURS</h2>
<div><div class="highlight-scala"><div class="highlight"><pre class="prettyprint lang-scala linenums"><span> </span><br><span class="pln">  </span><span class="nc">Procedure</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;</span><span class="pln"> </span><span class="n">angry</span><span class="pln"> </span><span class="k">=</span><span class="pln"> </span><span class="k">new</span><span class="pln"> </span><span class="nc">Procedure</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;()</span><span class="pln"> </span><span class="o">{</span><br><span class="pln">    </span><span class="nd">@Override</span><br><span class="pln">    </span><span class="n">public</span><span class="pln"> </span><span class="n">void</span><span class="pln"> </span><span class="n">apply</span><span class="o">(</span><span class="nc">Object</span><span class="pln"> </span><span class="n">message</span><span class="o">)</span><span class="pln"> </span><span class="o">{</span><br><span class="pln">      </span><span class="k">if</span><span class="pln"> </span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="n">equals</span><span class="o">(</span><span class="s">"bar"</span><span class="o">))</span><span class="pln"> </span><span class="o">{</span><br><span class="pln">        </span><span class="n">getSender</span><span class="o">().</span><span class="n">tell</span><span class="o">(</span><span class="s">"I am already angry?"</span><span class="o">,</span><span class="pln"> </span><span class="n">getSelf</span><span class="o">());</span><br><span class="pln">      </span><span class="o">}</span><span class="pln"> </span><span class="k">else</span><span class="pln"> </span><span class="k">if</span><span class="pln"> </span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="n">equals</span><span class="o">(</span><span class="s">"foo"</span><span class="o">))</span><span class="pln"> </span><span class="o">{</span><br><span class="pln">        </span><span class="n">getContext</span><span class="o">().</span><span class="n">become</span><span class="o">(</span><span class="n">happy</span><span class="o">);</span><br><span class="pln">      </span><span class="o">}</span><br><span class="pln">    </span><span class="o">}</span><br><span class="pln">  </span><span class="o">};</span><br><span> </span><br><span class="pln">  </span><span class="nc">Procedure</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;</span><span class="pln"> </span><span class="n">happy</span><span class="pln"> </span><span class="k">=</span><span class="pln"> </span><span class="k">new</span><span class="pln"> </span><span class="nc">Procedure</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;()</span><span class="pln"> </span><span class="o">{</span><br><span class="pln">    </span><span class="nd">@Override</span><br><span class="pln">    </span><span class="n">public</span><span class="pln"> </span><span class="n">void</span><span class="pln"> </span><span class="n">apply</span><span class="o">(</span><span class="nc">Object</span><span class="pln"> </span><span class="n">message</span><span class="o">)</span><span class="pln"> </span><span class="o">{</span><br><span class="pln">      </span><span class="k">if</span><span class="pln"> </span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="n">equals</span><span class="o">(</span><span class="s">"bar"</span><span class="o">))</span><span class="pln"> </span><span class="o">{</span><br><span class="pln">        </span><span class="n">getSender</span><span class="o">().</span><span class="n">tell</span><span class="o">(</span><span class="s">"I am already happy :-)"</span><span class="o">,</span><span class="pln"> </span><span class="n">getSelf</span><span class="o">());</span><br><span class="pln">      </span><span class="o">}</span><span class="pln"> </span><span class="k">else</span><span class="pln"> </span><span class="k">if</span><span class="pln"> </span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="n">equals</span><span class="o">(</span><span class="s">"foo"</span><span class="o">))</span><span class="pln"> </span><span class="o">{</span><br><span class="pln">        </span><span class="n">getContext</span><span class="o">().</span><span class="n">become</span><span class="o">(</span><span class="n">angry</span><span class="o">);</span><br><span class="pln">      </span><span class="o">}</span><br><span class="pln">    </span><span class="o">}</span><br><span class="pln">  </span><span class="o">};</span><br><span> </span><br></pre></div></div></div></section><section><h2>BECOME - RECV Message</h2>
<div><br></div>
<div><pre class="prettyprint lang-scala linenums" style="font-style: normal; font-variant: normal; width: 861.8338623046875px;"><span class="pln">  </span><span class="n">public</span><span class="pln"> </span><span class="n">void</span><span class="pln"> </span><span class="n">onReceive</span><span class="o">(</span><span class="nc">Object</span><span class="pln"> </span><span class="n">message</span><span class="o">)</span><span class="pln"> </span><span class="o">{</span><br><span class="pln">    </span><span class="k">if</span><span class="pln"> </span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="n">equals</span><span class="o">(</span><span class="s">"bar"</span><span class="o">))</span><span class="pln"> </span><span class="o">{</span><br><span class="pln">      </span><span class="n">getContext</span><span class="o">().</span><span class="n">become</span><span class="o">(</span><span class="n">angry</span><span class="o">);</span><br><span class="pln">    </span><span class="o">}</span><span class="pln"> </span><span class="k">else</span><span class="pln"> </span><span class="k">if</span><span class="pln"> </span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="n">equals</span><span class="o">(</span><span class="s">"foo"</span><span class="o">))</span><span class="pln"> </span><span class="o">{</span><br><span class="pln">      </span><span class="n">getContext</span><span class="o">().</span><span class="n">become</span><span class="o">(</span><span class="n">happy</span><span class="o">);</span><br><span class="pln">    </span><span class="o">}</span><span class="pln"> </span><span class="k">else</span><span class="pln"> </span><span class="o">{</span><br><span class="pln">      </span><span class="n">unhandled</span><span class="o">(</span><span class="n">message</span><span class="o">);</span><br><span class="pln">    </span><span class="o">}</span><br><span class="pln">  </span><span class="o">}</span><br></pre></div></section><section><h2>SUPERVISE</h2>
<div>￼Traditional failure management:<br>
</div>
<div><br></div>
<div>
<div>• You are given a SINGLE thread of control</div>
<div><br></div>
<div>
<span>• Need to do all explicit error handling WITHIN this single thread</span><br>
</div>
<div><span><br></span></div>
<div>• Errors do not propagate between threads</div>
<div><br></div>
<div>• Leads to DEFENSIVE programming with e<span>rror handling TANGLED with business logic</span>
</div>
</div></section><section><h2>SUPERVISE</h2>
<div>"Let it crash!"</div>
<div>
<div><br></div>
<div>• Error handling in actors is handle by letting Actors monitor (supervise) each other for failure</div>
<div><br></div>
<div>• If an Actor crashes, a notification will be sent to his supervisor, who can react upon the failure (Restart, Resume, Stop, Escalate)</div>
<div><br></div>
<div><ul><li>
<span style="text-align: center;">Provides clean separation of processing and error handling</span><br>
</li></ul></div>
</div></section><section><h2>SUPERVISE - Strategy</h2>
<div><div class="highlight-scala"><div class="highlight"><pre class="prettyprint lang-scala linenums"><span class="k">private</span><span class="pln"> </span><span class="n">static</span><span class="pln"> </span><span class="nc">SupervisorStrategy</span><span class="pln"> </span><span class="n">strategy</span><span class="pln"> </span><span class="k">=</span><br><span class="pln">  </span><span class="k">new</span><span class="pln"> </span><span class="nc">OneForOneStrategy</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span><span class="pln"> </span><span class="nc">Duration</span><span class="o">.</span><span class="n">create</span><span class="o">(</span><span class="s">"1 minute"</span><span class="o">),</span><br><span class="pln">    </span><span class="k">new</span><span class="pln"> </span><span class="nc">Function</span><span class="o">&lt;</span><span class="nc">Throwable</span><span class="o">,</span><span class="pln"> </span><span class="nc">Directive</span><span class="o">&gt;()</span><span class="pln"> </span><span class="o">{</span><br><span class="pln">      </span><span class="nd">@Override</span><br><span class="pln">      </span><span class="n">public</span><span class="pln"> </span><span class="nc">Directive</span><span class="pln"> </span><span class="n">apply</span><span class="o">(</span><span class="nc">Throwable</span><span class="pln"> </span><span class="n">t</span><span class="o">)</span><span class="pln"> </span><span class="o">{</span><br><span class="pln">        </span><span class="k">if</span><span class="pln"> </span><span class="o">(</span><span class="n">t</span><span class="pln"> </span><span class="n">instanceof</span><span class="pln"> </span><span class="nc">ArithmeticException</span><span class="o">)</span><span class="pln"> </span><span class="o">{</span><br><span class="pln">          </span><span class="k">return</span><span class="pln"> </span><span class="n">resume</span><span class="o">();</span><br><span class="pln">        </span><span class="o">}</span><span class="pln"> </span><span class="k">else</span><span class="pln"> </span><span class="k">if</span><span class="pln"> </span><span class="o">(</span><span class="n">t</span><span class="pln"> </span><span class="n">instanceof</span><span class="pln"> </span><span class="nc">NullPointerException</span><span class="o">)</span><span class="pln"> </span><span class="o">{</span><br><span class="pln">          </span><span class="k">return</span><span class="pln"> </span><span class="n">restart</span><span class="o">();</span><br><span class="pln">        </span><span class="o">}</span><span class="pln"> </span><span class="k">else</span><span class="pln"> </span><span class="k">if</span><span class="pln"> </span><span class="o">(</span><span class="n">t</span><span class="pln"> </span><span class="n">instanceof</span><span class="pln"> </span><span class="nc">IllegalArgumentException</span><span class="o">)</span><span class="pln"> </span><span class="o">{</span><br><span class="pln">          </span><span class="k">return</span><span class="pln"> </span><span class="n">stop</span><span class="o">();</span><br><span class="pln">        </span><span class="o">}</span><span class="pln"> </span><span class="k">else</span><span class="pln"> </span><span class="o">{</span><br><span class="pln">          </span><span class="k">return</span><span class="pln"> </span><span class="n">escalate</span><span class="o">();</span><br><span class="pln">        </span><span class="o">}</span><br><span class="pln">      </span><span class="o">}</span><br><span class="pln">    </span><span class="o">});</span><br><span> </span><br><span>@Override</span><br><span class="n">public</span><span class="pln"> </span><span class="nc">SupervisorStrategy</span><span class="pln"> </span><span class="n">supervisorStrategy</span><span class="o">()</span><span class="pln"> </span><span class="o">{</span><br><span class="pln">  </span><span class="k">return</span><span class="pln"> </span><span class="n">strategy</span><span class="o">;</span><br><span>}</span><br></pre></div></div></div>
<div><br></div></section><section><h2>SUPERVISE - Hooks</h2>
<div>
<p></p>
<div class="highlight-scala"><div class="highlight"><pre class="prettyprint lang-scala linenums"><span class="n">public</span><span class="pln"> </span><span class="n">void</span><span class="pln"> </span><span class="n">preStart</span><span class="o">()</span><span class="pln"> </span><span class="o">{</span><br><span>}</span><br><span> </span><br><span class="n">public</span><span class="pln"> </span><span class="n">void</span><span class="pln"> </span><span class="n">preRestart</span><span class="o">(</span><span class="nc">Throwable</span><span class="pln"> </span><span class="n">reason</span><span class="o">,</span><span class="pln"> </span><span class="n">scala</span><span class="o">.</span><span class="nc">Option</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;</span><span class="pln"> </span><span class="n">message</span><span class="o">)</span><span class="pln"> </span><span class="o">{</span><br><span class="pln">  </span><span class="k">for</span><span class="pln"> </span><span class="o">(</span><span class="nc">ActorRef</span><span class="pln"> </span><span class="n">each</span><span class="pln"> </span><span class="k">:</span><span class="pln"> </span><span class="kt">getContext</span><span class="o">()</span><span class="kt"><span class="pun">.</span><span class="pln">getChildren</span></span><span class="o">())</span><span class="pln"> </span><span class="o">{</span><br><span class="pln">    </span><span class="n">getContext</span><span class="o">().</span><span class="n">unwatch</span><span class="o">(</span><span class="n">each</span><span class="o">);</span><br><span class="pln">    </span><span class="n">getContext</span><span class="o">().</span><span class="n">stop</span><span class="o">(</span><span class="n">each</span><span class="o">);</span><br><span class="pln">  </span><span class="o">}</span><br><span class="pln">  </span><span class="n">postStop</span><span class="o">();</span><br><span>}</span><br><span> </span><br><span class="n">public</span><span class="pln"> </span><span class="n">void</span><span class="pln"> </span><span class="n">postRestart</span><span class="o">(</span><span class="nc">Throwable</span><span class="pln"> </span><span class="n">reason</span><span class="o">)</span><span class="pln"> </span><span class="o">{</span><br><span class="pln">  </span><span class="n">preStart</span><span class="o">();</span><br><span>}</span><br><span> </span><br><span class="n">public</span><span class="pln"> </span><span class="n">void</span><span class="pln"> </span><span class="n">postStop</span><span class="o">()</span><span class="pln"> </span><span class="o">{</span><br><span>}</span><br></pre></div></div>
</div></section><section><h2>ROUTERS - LOAD BALANCERS</h2>
<div><div class="highlight-scala"><div class="highlight"><pre class="prettyprint lang-scala linenums"><span class="nc">ActorRef</span><span class="pln"> </span><span class="n">roundRobinRouter</span><span class="pln"> </span><span class="k">=</span><span class="pln"> </span><span class="n">getContext</span><span class="o">().</span><span class="n">actorOf</span><span class="o">(</span><br><span class="pln">    </span><span class="nc">Props</span><span class="o">.</span><span class="n">create</span><span class="o">(</span><span class="nc">PrintlnActor</span><span class="o">.</span><span class="n">class</span><span class="o">).</span><span class="n">withRouter</span><span class="o">(</span><span class="k">new</span><span class="pln"> </span><span class="nc">RoundRobinRouter</span><span class="o">(</span><span class="mi">5</span><span class="o">)),</span><br><span class="pln">  </span><span class="s">"router"</span><span class="o">);</span><br><br><span class="k">for</span><span class="pln"> </span><span class="o">(</span><span class="n">int</span><span class="pln"> </span><span class="n">i</span><span class="pln"> </span><span class="k">=</span><span class="pln"> </span><span class="mi">1</span><span class="o">;</span><span class="pln"> </span><span class="n">i</span><span class="pln"> </span><span class="o">&lt;=</span><span class="pln"> </span><span class="mi">10</span><span class="o">;</span><span class="pln"> </span><span class="n">i</span><span class="o">++)</span><span class="pln"> </span><span class="o">{</span><br><span class="pln">  </span><span class="n">roundRobinRouter</span><span class="o">.</span><span class="n">tell</span><span class="o">(</span><span class="n">i</span><span class="o">,</span><span class="pln"> </span><span class="n">getSelf</span><span class="o">());</span><br><span>}</span><br></pre></div></div></div>
<div><ol class="linenums" style="margin-left: 40px; list-style-position: initial; list-style-image: initial; color: rgb(51, 51, 51); font-size: 12px; font-style: normal; font-variant: normal; white-space: pre-wrap;"><li class="L9" style="color: rgba(0, 0, 0, 0.14902);"><br></li></ol></div></section><section><h2>THROTTLING</h2>
<div><div class="highlight-scala"><div class="highlight"><pre class="prettyprint lang-scala linenums"><span class="pln">  </span><span class="c1">// A simple actor that prints whatever it receives</span><br><span class="pln">  </span><span class="nc">ActorRef</span><span class="pln"> </span><span class="n">printer</span><span class="pln"> </span><span class="k">=</span><span class="pln"> </span><span class="n">system</span><span class="o">.</span><span class="n">actorOf</span><span class="o">(</span><span class="nc">Props</span><span class="o">.</span><span class="n">create</span><span class="o">(</span><span class="nc">Printer</span><span class="o">.</span><span class="n">class</span><span class="o">));</span><br><span class="pln">  </span><span class="c1">// The throttler for this example, setting the rate</span><br><span class="pln">  </span><span class="nc">ActorRef</span><span class="pln"> </span><span class="n">throttler</span><span class="pln"> </span><span class="k">=</span><span class="pln"> </span><span class="n">system</span><span class="o">.</span><span class="n">actorOf</span><span class="o">(</span><span class="nc">Props</span><span class="o">.</span><span class="n">create</span><span class="o">(</span><span class="nc">TimerBasedThrottler</span><span class="o">.</span><span class="n">class</span><span class="o">,</span><br><span class="pln">      </span><span class="k">new</span><span class="pln"> </span><span class="nc">Throttler</span><span class="o">.</span><span class="nc">Rate</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="pln"> </span><span class="nc">Duration</span><span class="o">.</span><span class="n">create</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="pln"> </span><span class="nc">TimeUnit</span><span class="o">.</span><span class="nc">SECONDS</span><span class="o">))));</span><br><span class="pln">  </span><span class="c1">// Set the target</span><br><span class="pln">  </span><span class="n">throttler</span><span class="o">.</span><span class="n">tell</span><span class="o">(</span><span class="k">new</span><span class="pln"> </span><span class="nc">Throttler</span><span class="o">.</span><span class="nc">SetTarget</span><span class="o">(</span><span class="n">printer</span><span class="o">),</span><span class="pln"> </span><span class="kc">null</span><span class="o">);</span><br><span class="pln">  </span><span class="c1">// These three messages will be sent to the target immediately</span><br><span class="pln">  </span><span class="n">throttler</span><span class="o">.</span><span class="n">tell</span><span class="o">(</span><span class="s">"1"</span><span class="o">,</span><span class="pln"> </span><span class="kc">null</span><span class="o">);</span><br><span class="pln">  </span><span class="n">throttler</span><span class="o">.</span><span class="n">tell</span><span class="o">(</span><span class="s">"2"</span><span class="o">,</span><span class="pln"> </span><span class="kc">null</span><span class="o">);</span><br><span class="pln">  </span><span class="n">throttler</span><span class="o">.</span><span class="n">tell</span><span class="o">(</span><span class="s">"3"</span><span class="o">,</span><span class="pln"> </span><span class="kc">null</span><span class="o">);</span><br><span class="pln">  </span><span class="c1">// These two will wait until a second has passed</span><br><span class="pln">  </span><span class="n">throttler</span><span class="o">.</span><span class="n">tell</span><span class="o">(</span><span class="s">"4"</span><span class="o">,</span><span class="pln"> </span><span class="kc">null</span><span class="o">);</span><br><span class="pln">  </span><span class="n">throttler</span><span class="o">.</span><span class="n">tell</span><span class="o">(</span><span class="s">"5"</span><span class="o">,</span><span class="pln"> </span><span class="kc">null</span><span class="o">);</span><br><span> </span><br><span>//A simple actor that prints whatever it receives</span><br><span class="n">public</span><span class="pln"> </span><span class="k">class</span><span class="pln"> </span><span class="nc">Printer</span><span class="pln"> </span><span class="k">extends</span><span class="pln"> </span><span class="nc">UntypedActor</span><span class="pln"> </span><span class="o">{</span><br><span class="pln">  </span><span class="nd">@Override</span><br><span class="pln">  </span><span class="n">public</span><span class="pln"> </span><span class="n">void</span><span class="pln"> </span><span class="n">onReceive</span><span class="o">(</span><span class="nc">Object</span><span class="pln"> </span><span class="n">msg</span><span class="o">)</span><span class="pln"> </span><span class="o">{</span><br><span class="pln">    </span><span class="nc">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span><br><span class="pln">  </span><span class="o">}</span><br><span>}</span><br></pre></div></div></div></section><section><h2>CIRCUIT BREAKERS</h2>
<div><pre class="prettyprint lang-scala linenums"><span class="n" style="font-family: monospace;">public</span><span class="pln" style="font-family: monospace;"> </span><span class="k" style="font-family: monospace;">class</span><span class="pln" style="font-family: monospace;"> </span><span class="nc" style="font-family: monospace;">DangerousJavaActor</span><span class="pln" style="font-family: monospace;"> </span><span class="k" style="font-family: monospace;">extends</span><span class="pln" style="font-family: monospace;"> </span><span class="nc" style="font-family: monospace;">UntypedActor</span><span class="pln" style="font-family: monospace;"> </span><span class="o" style="font-family: monospace;">{</span><br><span> </span><br><span class="pln">  </span><span class="k">private</span><span class="pln"> </span><span class="k">final</span><span class="pln"> </span><span class="nc">CircuitBreaker</span><span class="pln"> </span><span class="n">breaker</span><span class="o">;</span><br><span class="pln">  </span><span class="k">private</span><span class="pln"> </span><span class="k">final</span><span class="pln"> </span><span class="nc">LoggingAdapter</span><span class="pln"> </span><span class="n">log</span><span class="pln"> </span><span class="k">=</span><span class="pln"> </span><span class="nc">Logging</span><span class="o">.</span><span class="n">getLogger</span><span class="o">(</span><span class="n">getContext</span><span class="o">().</span><span class="n">system</span><span class="o">(),</span><span class="pln"> </span><span class="k">this</span><span class="o">);</span><br><span> </span><br><span class="pln">  </span><span class="n">public</span><span class="pln"> </span><span class="nc">DangerousJavaActor</span><span class="o">()</span><span class="pln"> </span><span class="o">{</span><br><span class="pln">    </span><span class="k">this</span><span class="o">.</span><span class="n">breaker</span><span class="pln"> </span><span class="k">=</span><span class="pln"> </span><span class="k">new</span><span class="pln"> </span><span class="nc">CircuitBreaker</span><span class="o">(</span><br><span class="pln">      </span><span class="n">getContext</span><span class="o">().</span><span class="n">dispatcher</span><span class="o">(),</span><span class="pln"> </span><span class="n">getContext</span><span class="o">().</span><span class="n">system</span><span class="o">().</span><span class="n">scheduler</span><span class="o">(),</span><br><span class="pln">      </span><span class="mi">5</span><span class="o">,</span><span class="pln"> </span><span class="nc">Duration</span><span class="o">.</span><span class="n">create</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span><span class="pln"> </span><span class="s">"s"</span><span class="o">),</span><span class="pln"> </span><span class="nc">Duration</span><span class="o">.</span><span class="n">create</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="pln"> </span><span class="s">"m"</span><span class="o">))</span><br><span class="pln">      </span><span class="o">.</span><span class="n">onOpen</span><span class="o">(</span><span class="k">new</span><span class="pln"> </span><span class="nc">Runnable</span><span class="o">()</span><span class="pln"> </span><span class="o">{</span><br><span class="pln">        </span><span class="n">public</span><span class="pln"> </span><span class="n">void</span><span class="pln"> </span><span class="n">run</span><span class="o">()</span><span class="pln"> </span><span class="o">{</span><br><span class="pln">          </span><span class="n">notifyMeOnOpen</span><span class="o">();</span><br><span class="pln">        </span><span class="o">}</span><br><span class="pln">      </span><span class="o">});</span><br><span class="pln">  </span><span class="o">}</span><br><span> </span><br><span class="pln">  </span><span class="n">public</span><span class="pln"> </span><span class="n">void</span><span class="pln"> </span><span class="n">notifyMeOnOpen</span><span class="o">()</span><span class="pln"> </span><span class="o">{</span><br><span class="pln">    </span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="o">(</span><span class="s">"My CircuitBreaker is now open, and will not close for one minute"</span><span class="o">);</span><br><span class="pln">  </span><span class="o">}</span><br></pre></div></section>
			</div>
		</div>

		
<script>
	var SLConfig = {"deck":{"id":94344,"slug":"akka","title":"AKKA","description":"","visibility":"all","published_at":"2013-11-21T21:42:03Z","sanitize_messages":null,"thumbnail_url":"https://s3.amazonaws.com/media-p.slid.es/thumbnails/gaelmartin/21ebfe/akka.jpg","view_count":139,"user":{"id":84235,"username":"gaelmartin","name":"Gael Martin","email":"gael.martin@lifecycle-software.com","description":null,"thumbnail_url":"https://www.gravatar.com/avatar/450c56f0bb8690269da2e048bb497bc0?s=140&d=https%3A%2F%2Fs3.amazonaws.com%2Fstatic.slid.es%2Fimages%2Fdefault-profile-picture.png","pro":false,"enterprise":false,"notify_on_receipt":false,"billing_address":null,"registered":true},"background_transition":"fade","transition":"linear","theme_id":null,"theme_font":"league","theme_color":"lila-yellow","auto_slide_interval":0,"comments_enabled":true,"forking_enabled":true,"rolling_links":false,"center":false,"should_loop":false,"rtl":false}};
</script>
		<script src="//slid.es/assets/application-b400aa2889a04fa7c29f9048014c0800.js" type="text/javascript"></script>
		<script src="//slid.es/assets/reveal.min-9e67a77dbdf85fe4ffc45a9edf98b43b.js" type="text/javascript"></script>
		

		
	<script type="text/javascript">if (!NREUMQ.f) { NREUMQ.f=function() {
NREUMQ.push(["load",new Date().getTime()]);
var e=document.createElement("script");
e.type="text/javascript";
e.src=(("http:"===document.location.protocol)?"http:":"https:") + "//" +
  "js-agent.newrelic.com/nr-100.js";
document.body.appendChild(e);
if(NREUMQ.a)NREUMQ.a();
};
NREUMQ.a=window.onload;window.onload=NREUMQ.f;
};
NREUMQ.push(["nrfj","beacon-5.newrelic.com","4fd2e9786b","1563900","cApZREQKWl9XFxZQVlAORB9QEFpfQQZLUVZd",0,158,new Date().getTime(),"","","","",""]);</script></body>
</html>